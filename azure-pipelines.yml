trigger:
  - none

pool:
  name: bara
  demands:
    - agent.name -equals vmagentm

steps:
- script: 
    pwd
    
- script: |
    flutter --version
    flutter pub outdated
    flutter pub upgrade --major-versions
    flutter pub get
  displayName: 'Run Flutter Commands'

- task: FlutterBuild@0
  inputs:
    target: 'apk'
    projectDirectory: './'  # Ensure this points to your project
    flutterDirectory: '/home/azureuser/myagent/sdk/flutter/bin'
    
- script: 
    pwd
    
- script: |
      flutter test test/widget_test.dart
  displayName: 'test integration and '

- script: |
      flutter pub get
      flutter pub run build_runner build
      flutter test test/register_controller_test.dart
      flutter test test/register_page_test.dart
  displayName: ' test junit test'

- script: flutter test --machine > test-results.txt || true
  displayName: 'create test-results.txt'
- task: PublishTestResults@2
  inputs:
  
      testResultsFiles: '/test/test-results.txt'
      testResultsFormat: 'JUnit'